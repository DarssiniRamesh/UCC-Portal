#!/usr/bin/env bash
# Tooling wrapper for `sass` to support CI systems that call it directly.
set -euo pipefail
ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
if [ "${1:-}" = "scss/index.scss" ] && [ "${2:-}" = "css/index.css" ]; then
  exec bash "${ROOT_DIR}/scripts/build-css.sh"
fi

if command -v npx >/dev/null 2>&1 && npx --yes --quiet sass --version >/dev/null 2>&1; then
  exec npx sass "$@"
fi

# Fallback if sass isn't available
if [[ "$#" -ge 2 ]]; then
  SRC="$1"
  DST="$2"
  if [[ "$SRC" == "scss/index.scss" && "$DST" == "css/index.css" ]]; then
    cp -f "${ROOT_DIR}/css/index.fallback.css" "${ROOT_DIR}/css/index.css"
    echo "[tools/sass] sass unavailable; copied fallback CSS"
    exit 0
  fi
fi

echo "[tools/sass] sass not available and unsupported args: $*" >&2
exit 127
