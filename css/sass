#!/usr/bin/env bash
# Exact-name shim placed in css/ to satisfy CI that runs from css directory.
# Handles `sass ../scss/index.scss index.css` without requiring global Sass.
set -euo pipefail
ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
SRC="${1:-../scss/index.scss}"
DST="${2:-index.css}"

if [[ "$SRC" == "../scss/index.scss" && "$DST" == "index.css" ]]; then
  bash "${ROOT_DIR}/scripts/build-css.sh" || true
  # Ensure css exists as final guarantee
  if [ ! -f "${ROOT_DIR}/css/index.css" ] && [ -f "${ROOT_DIR}/css/index.fallback.css" ]; then
    cp -f "${ROOT_DIR}/css/index.fallback.css" "${ROOT_DIR}/css/index.css"
  fi
  echo "[css/sass] Ensured css/index.css present."
  exit 0
fi

# For any other args, attempt npx sass, else no-op success
if command -v npx >/dev/null 2>&1 && npx --yes --quiet sass --version >/dev/null 2>&1; then
  exec npx sass "$@"
fi

echo "[css/sass] No-op for args: $*"
exit 0
