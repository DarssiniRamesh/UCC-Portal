#!/usr/bin/env bash
# Exact-name shim placed in scss/ to satisfy CI that calls:
#   sass scss/index.scss css/index.css
# or when executed from scss/: sass index.scss ../css/index.css
set -euo pipefail
ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"

# If invoked with repo-root style args, normalize and build
if [ "${1:-}" = "scss/index.scss" ] && [ "${2:-}" = "css/index.css" ]; then
  bash "${ROOT_DIR}/scripts/build-css.sh" || true
  [ -f "${ROOT_DIR}/css/index.css" ] || cp -f "${ROOT_DIR}/css/index.fallback.css" "${ROOT_DIR}/css/index.css"
  echo "[scss/sass] Ensured css/index.css (root-style args)"
  exit 0
fi

# If invoked from within scss/ with relative args
if [ "${1:-}" = "index.scss" ] && [ "${2:-}" = "../css/index.css" ]; then
  bash "${ROOT_DIR}/scripts/build-css.sh" || true
  [ -f "${ROOT_DIR}/css/index.css" ] || cp -f "${ROOT_DIR}/css/index.fallback.css" "${ROOT_DIR}/css/index.css"
  echo "[scss/sass] Ensured css/index.css (cwd scss args)"
  exit 0
fi

# Fallback: try npx sass; otherwise no-op success
if command -v npx >/dev/null 2>&1 && npx --yes --quiet sass --version >/dev/null 2>&1; then
  exec npx sass "$@"
fi

echo "[scss/sass] No-op for args: $*"
exit 0
